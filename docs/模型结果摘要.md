# 模型结果摘要

---

## 一、回归模型结果（住院天数预测）

### 1.1 模型评估指标

| 模型 | 特征数 | 测试集 R² | 测试集 RMSE | 测试集 MAE |
|------|--------|-----------|------------|-----------|
| 基准模型 | 12 | 0.2645 | 2.5442天 | 1.9123天 |
| 改进模型 | 20 | **0.2856** | **2.5483天** | **1.8601天** |

**模型改进**：
- R²提升：0.0211（从26.5%提升到28.6%）
- RMSE变化：+0.0041天（差异很小，在可接受范围内）
- MAE降低：0.0522天

### 1.2 模型诊断结果

- **残差分析**：Shapiro-Wilk检验统计量=0.9394，p<0.001（样本量大时常见）
- **多重共线性**：所有变量VIF < 10，无严重多重共线性问题
- **模型解释力**：能解释约29%的住院天数方差

### 1.3 主要影响因素

根据回归系数（改进模型），影响住院天数的主要因素：
1. **诊断数量**（`number_diagnoses`）：诊断数量越多，住院天数越长
2. **用药数量**（`num_medications`）：用药越多，住院天数越长
3. **实验室检查次数**（`num_lab_procedures`）：检查次数多，住院天数长
4. **年龄**：老年患者住院天数更长
5. **既往住院次数**（`number_inpatient`）：既往住院次数多，本次住院天数长

---

## 二、分类模型结果（30天再入院预测）

### 2.1 模型评估指标

| 模型 | 特征数 | 准确率 | 精确率 | 召回率 | F1值 | AUC |
|------|--------|--------|--------|--------|------|-----|
| 基准模型 | 11 | 0.4471 | 0.1380 | 0.7628 | 0.2338 | 0.6373 |
| 改进模型 | 19 | **0.5350** | **0.1484** | **0.6765** | **0.2435** | **0.6419** |

**模型特点**：
- 使用类别权重处理数据不平衡（再入院率11.16%）
- 召回率67.7%，能识别约三分之二的再入院患者
- AUC=0.64，模型具有一定的区分能力

### 2.2 OR值（优势比）分析

**主要风险因素**（OR > 1表示增加风险）：

| 变量 | OR值 | 解释 |
|------|------|------|
| 既往住院次数（`number_inpatient`） | **1.45** | 既往住院次数每增加1次，再入院风险增加45% |
| 诊断数量（`number_diagnoses`） | **1.11** | 诊断数量每增加1个，再入院风险增加11% |
| 既往急诊次数（`number_emergency`） | **1.09** | 既往急诊次数每增加1次，再入院风险增加9% |
| 用药数量（`num_medications`） | **1.06** | 用药数量每增加1个，再入院风险增加6% |
| 出院去向分组（`discharge_disposition_group`） | **1.12** | 出院去向不同，再入院风险有差异 |

**保护因素**（OR < 1表示降低风险）：
- 某些入院类型和种族可能降低再入院风险（需结合具体类别解释）

### 2.3 关键发现

1. **既往住院次数是最强的风险因素**（OR=1.45）
2. **合并症数量（诊断数量）是重要风险因素**（OR=1.11）
3. **既往就医频率高（急诊/住院）的患者风险更高**
4. **用药数量多可能反映病情复杂，风险更高**

---

## 三、模型对比总结

### 3.1 回归模型
- ✅ 改进模型相比基准模型有明显提升
- ✅ 模型诊断通过，无严重问题
- ✅ 能解释约31%的住院天数方差（在医疗数据中属于合理水平）

### 3.2 分类模型
- ✅ 使用类别权重处理不平衡问题
- ✅ 召回率67.7%，能识别约三分之二的再入院患者
- ✅ AUC=0.64，模型具有一定的区分能力（考虑到数据不平衡和问题难度，可接受）

---

## 四、可视化图表

### 4.1 回归模型图表
- `docs/figures/07_regression_coefficients.png` - 回归系数条形图
- `docs/figures/08_regression_diagnostics.png` - 残差诊断图（4个子图）

### 4.2 分类模型图表
- `docs/figures/09_classification_or_values.png` - OR值条形图
- `docs/figures/10_classification_confusion_matrix.png` - 混淆矩阵
- `docs/figures/11_classification_roc_curve.png` - ROC曲线
- `docs/figures/12_classification_probability_distribution.png` - 预测概率分布

---

## 五、模型文件

- `models/regression_model.rds` - 回归模型（包含基准和改进模型，R格式）
- `models/classification_model.rds` - 分类模型（包含基准和改进模型，R格式）

---

## 六、系统功能

原型系统（Shiny）包含以下功能：
1. **数据概览**：展示EDA图表和数据基本信息
2. **预处理展示**：展示数据清洗和特征工程过程
3. **模型结果**：展示模型评估指标和可视化图表
4. **风险预测**：交互式输入患者特征，预测再入院风险和住院天数

**启动命令**（在R或RStudio中）：
```r
shiny::runApp("code/09_shiny_app")
```

---

## 七、技术要点（供报告使用）

### 7.1 特征工程
- ICD-9诊断编码分组（8个类别）
- 出院去向分组（5个类别）
- 入院来源分组（4个类别）
- 处理高缺失率变量（创建指示变量）

### 7.2 模型方法
- **回归**：多元线性回归（使用R的`lm()`函数，标准化特征）
- **分类**：Logistic回归（使用R的`glm()`函数，类别权重处理不平衡）

### 7.3 模型评估
- **回归**：R²、RMSE、MAE、残差诊断、VIF检查
- **分类**：准确率、精确率、召回率、F1、AUC、ROC曲线、OR值

---

## 八、建议与改进方向

1. **模型改进**：
   - 可尝试其他模型（如随机森林、XGBoost）进行对比
   - 进一步特征工程（如创建更多交互项）

2. **数据改进**：
   - 收集更多特征（如实验室检查结果、生命体征等）
   - 考虑时间序列特征（如上次住院时间间隔）

3. **系统改进**：
   - 添加模型解释性可视化（如SHAP值）
   - 优化预测界面，增加更多输入选项

