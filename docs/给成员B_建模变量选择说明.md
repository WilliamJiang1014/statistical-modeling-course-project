# 给成员B：建模变量选择说明文档

## 一、数据基本信息

### 数据文件位置
- **清洗后的数据**：`data/processed/diabetic_data_cleaned.csv`
- **数据规模**：16,777条记录，53个变量
- **数据来源**：通过分层抽样从原始101,766条记录中抽取（符合10MB要求）
- **数据质量**：已通过验证，关键变量无缺失值，分布特征保持完整

### 数据清洗情况
- ✅ 已删除重复记录（0条）
- ✅ 已处理特殊值'?'（替换为NaN后填充）
- ✅ 已创建因变量和衍生变量
- ✅ 关键变量缺失值已处理

---

## 二、因变量说明

### 1. 分类任务：30天内再入院预测
- **变量名**：`readmitted_30d`
- **类型**：二分类变量（0/1）
- **取值**：
  - `0` = 未在30天内再入院（14,905例，88.84%）
  - `1` = 30天内再入院（1,872例，11.16%）
- **数据不平衡**：存在类别不平衡，建议考虑处理策略（如SMOTE、类别权重等）

### 2. 回归任务：住院天数预测
- **变量名**：`time_in_hospital`
- **类型**：连续变量（整数）
- **统计信息**：
  - 平均值：4.40天
  - 中位数：4天
  - 标准差：2.99天
  - 范围：[1, 14]天
- **分布**：右偏分布，大部分患者住院时间较短

---

## 三、可用变量列表

### 3.1 人口学变量（推荐使用）
| 变量名 | 类型 | 取值/说明 | 缺失值 | 建议 |
|--------|------|-----------|--------|------|
| `age` | 分类 | [0-10), [10-20), ..., [90-100) | 无 | ✅ 推荐使用 |
| `gender` | 分类 | Male, Female, Unknown/Invalid | 无（已填充） | ✅ 推荐使用 |
| `race` | 分类 | Caucasian, AfricanAmerican, Asian, Hispanic, Other, Unknown | 无（已填充） | ✅ 推荐使用 |

### 3.2 住院相关变量（推荐使用）
| 变量名 | 类型 | 说明 | 缺失值 | 建议 |
|--------|------|------|--------|------|
| `admission_type_id` | 分类 | 入院类型（1-8，需参考映射表） | 无 | ✅ 推荐使用 |
| `discharge_disposition_id` | 分类 | 出院去向（1-30，需参考映射表） | 无 | ⚠️ 注意：类别较多，可能需要分组 |
| `admission_source_id` | 分类 | 入院来源（1-25，需参考映射表） | 无 | ⚠️ 注意：类别较多，可能需要分组 |
| `time_in_hospital` | 连续 | 住院天数（因变量-回归任务） | 无 | ✅ 因变量 |

### 3.3 既往就医史（推荐使用）
| 变量名 | 类型 | 说明 | 缺失值 | 建议 |
|--------|------|------|--------|------|
| `number_outpatient` | 连续 | 既往门诊次数 | 无 | ✅ 推荐使用 |
| `number_emergency` | 连续 | 既往急诊次数 | 无 | ✅ 推荐使用 |
| `number_inpatient` | 连续 | 既往住院次数 | 无 | ✅ 推荐使用 |

### 3.4 诊断相关变量（推荐使用）
| 变量名 | 类型 | 说明 | 缺失值 | 建议 |
|--------|------|------|--------|------|
| `diag_1` | 分类 | 主要诊断（ICD-9编码） | 无（已填充Unknown） | ⚠️ 需要分组处理（如糖尿病相关、心血管相关等） |
| `diag_2` | 分类 | 次要诊断1（ICD-9编码） | 无（已填充Unknown） | ⚠️ 同diag_1 |
| `diag_3` | 分类 | 次要诊断2（ICD-9编码） | 无（已填充Unknown） | ⚠️ 同diag_1 |
| `number_diagnoses` | 连续 | 诊断数量（1-16） | 无 | ✅ **强烈推荐**：可作为合并症数量的代理指标 |

### 3.5 治疗相关变量（推荐使用）
| 变量名 | 类型 | 说明 | 缺失值 | 建议 |
|--------|------|------|--------|------|
| `num_lab_procedures` | 连续 | 实验室检查次数（1-132） | 无 | ✅ 推荐使用 |
| `num_procedures` | 连续 | 操作/手术次数（0-6） | 无 | ✅ 推荐使用 |
| `num_medications` | 连续 | 用药数量（1-81） | 无 | ✅ **强烈推荐** |
| `diabetesMed` | 分类 | 是否使用糖尿病药物（Yes/No） | 无 | ✅ 推荐使用 |
| `insulin_use` | 二分类 | 是否使用胰岛素（0/1，已创建） | 无 | ✅ **强烈推荐**：已简化 |
| `medication_changed` | 二分类 | 药物是否有变化（0/1，已创建） | 无 | ✅ 推荐使用 |

### 3.6 药物变量（需谨慎使用）
| 变量名 | 类型 | 说明 | 缺失值 | 建议 |
|--------|------|------|--------|------|
| `metformin`, `repaglinide`, `glipizide`, `glyburide`等 | 分类 | 各种药物使用情况（No/Steady/Up/Down） | 无 | ⚠️ 变量较多，建议选择关键药物或合并使用 |

### 3.7 高缺失率变量（不推荐直接使用）
| 变量名 | 类型 | 缺失率 | 建议 |
|--------|------|--------|------|
| `weight` | 分类 | 96.86% | ❌ 不推荐直接使用，可考虑创建"是否有体重数据"指示变量 |
| `max_glu_serum` | 分类 | 94.75% | ❌ 不推荐直接使用，可考虑创建"是否有血糖数据"指示变量 |
| `A1Cresult` | 分类 | 83.28% | ❌ 不推荐直接使用，可考虑创建"是否有A1C数据"指示变量 |
| `payer_code` | 分类 | 39.56% | ⚠️ 缺失率较高，已填充为Unknown，可谨慎使用 |
| `medical_specialty` | 分类 | 49.08% | ⚠️ 缺失率较高，已填充为Unknown，可谨慎使用 |

### 3.8 其他变量
| 变量名 | 类型 | 说明 | 建议 |
|--------|------|------|------|
| `encounter_id` | ID | 住院记录ID | ❌ 不用于建模 |
| `patient_nbr` | ID | 患者ID | ❌ 不用于建模 |
| `readmitted` | 分类 | 原始再入院变量（NO/<30/>30） | ❌ 不用于建模（已转换为readmitted_30d） |
| `change` | 分类 | 药物变化（已转换为medication_changed） | ❌ 不用于建模 |

---

## 四、EDA关键发现（变量选择参考）

### 4.1 与再入院相关的关键变量
根据EDA分析，以下变量与30天再入院率相关：
- **年龄**：不同年龄组的再入院率存在差异
- **诊断数量**：诊断数量越多的患者，再入院率越高
- **住院天数**：住院天数较长的患者，再入院率可能更高
- **性别**：可能存在差异（需进一步验证）

### 4.2 与住院天数相关的关键变量
根据EDA分析，以下变量与住院天数相关：
- **年龄**：老年患者住院天数更长
- **诊断数量**：诊断数量越多，住院天数越长
- **再入院情况**：再入院患者平均住院天数可能更长

### 4.3 多重共线性问题
相关性热力图显示：
- `num_lab_procedures`, `num_procedures`, `num_medications` 与 `number_diagnoses` 之间存在正相关
- `number_outpatient`, `number_emergency`, `number_inpatient` 之间可能存在相关性
- **建议**：在建模时注意检查多重共线性，可能需要选择代表性变量或进行降维

---

## 五、变量选择建议

### 5.1 基准模型（推荐变量）
**分类模型（预测30天再入院）**：
- 人口学：`age`, `gender`, `race`
- 既往就医：`number_outpatient`, `number_emergency`, `number_inpatient`
- 诊断：`number_diagnoses`
- 治疗：`num_medications`, `insulin_use`, `diabetesMed`
- 住院：`admission_type_id`, `time_in_hospital`（注意：住院天数可能是结果而非原因）

**回归模型（预测住院天数）**：
- 人口学：`age`, `gender`, `race`
- 既往就医：`number_outpatient`, `number_emergency`, `number_inpatient`
- 诊断：`number_diagnoses`
- 治疗：`num_lab_procedures`, `num_procedures`, `num_medications`
- 入院：`admission_type_id`, `admission_source_id`

### 5.2 改进模型（可考虑添加）
- 诊断编码分组（`diag_1`, `diag_2`, `diag_3`）：需要根据ICD-9编码进行分组（如糖尿病相关、心血管相关等）
- 出院去向（`discharge_disposition_id`）：可能需要分组处理
- 药物变量：选择关键药物或创建综合指标
- 交互项：如 `age × number_diagnoses`, `gender × insulin_use` 等

### 5.3 变量编码建议
- **分类变量**：使用哑变量（One-Hot Encoding）或标签编码
- **有序分类变量**（如age）：可考虑序数编码或保持分类
- **高基数分类变量**（如`discharge_disposition_id`）：建议分组或使用目标编码

---

## 六、数据格式说明

### 6.1 数据读取
```python
import pandas as pd
df = pd.read_csv('data/processed/diabetic_data_cleaned.csv')
```

### 6.2 因变量
- 分类任务：`df['readmitted_30d']`（0/1）
- 回归任务：`df['time_in_hospital']`（连续变量）

### 6.3 数据质量
- 所有关键变量无缺失值
- 分类变量的缺失值已填充为'Unknown'
- 数据已通过验证，可直接使用

---

## 七、注意事项

### 7.1 数据不平衡
- 30天再入院率仅11.16%，存在类别不平衡
- **建议**：使用类别权重、SMOTE过采样或其他平衡策略

### 7.2 多重共线性
- 某些变量之间存在相关性
- **建议**：建模时检查VIF（方差膨胀因子），必要时进行变量选择或降维

### 7.3 高缺失率变量
- `weight`, `max_glu_serum`, `A1Cresult` 缺失率>80%
- **建议**：不直接使用，可考虑创建"是否有该指标"的指示变量

### 7.4 变量编码
- 某些分类变量类别较多（如`discharge_disposition_id`有30个类别）
- **建议**：考虑分组或使用其他编码方式

### 7.5 因果推断
- 注意区分预测变量和结果变量
- 例如：`time_in_hospital`在预测再入院时需谨慎使用（可能是结果而非原因）

---

## 八、下一步工作建议

1. **变量选择**：
   - 先使用基准模型变量集
   - 根据模型结果逐步添加变量
   - 注意检查多重共线性

2. **特征工程**：
   - 诊断编码分组（ICD-9编码）
   - 创建交互项
   - 处理高基数分类变量

3. **模型选择**：
   - 分类：Logistic回归（可解释性强）
   - 回归：多元线性回归
   - 可考虑对比其他模型（如随机森林、XGBoost等）

4. **模型评估**：
   - 分类：准确率、精确率、召回率、F1值、AUC、ROC曲线
   - 回归：R²、调整R²、RMSE、MAE
   - 残差诊断（回归模型）

---

## 九、联系与协作

如有任何问题，请及时沟通：
- 数据格式问题
- 变量选择疑问
- 需要补充的分析
- 模型结果解读

**数据文件位置**：`data/processed/diabetic_data_cleaned.csv`  
**变量说明表**：`docs/02_variable_documentation.csv`  
**EDA图表**：`docs/figures/`  
**EDA分析结论**：`docs/图表分析结论.md`

---

**祝建模顺利！** 🚀

